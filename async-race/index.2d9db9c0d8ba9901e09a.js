(()=>{"use strict";const t=class{constructor(t,e){this.container=document.createElement(t),this.container.className=e}async render(){return this.container}},e=class extends t{getElementTemplate(){return'\n      <div class="header__container container">\n        <button class="header__btn header__btn_active btn" type="button" id="toGarage" data-section="garage">\n        </button>\n        <button class="header__btn btn" type="button" id="toWinner" data-section="winners"></button>\n      </div>\n    '}async addListeners(){const t=this.container.querySelectorAll(".header__btn"),e=document.querySelectorAll("section");t.forEach((n=>{n.addEventListener("click",(n=>{n.preventDefault(),t.forEach((t=>t.classList.remove("header__btn_active")));const a=n.target;a.classList.toggle("header__btn_active"),e.forEach((t=>t.classList.remove("active")));const s=a.dataset.section;s&&document.getElementById(s)?.classList.add("active")}))}))}async render(){const t=this.getElementTemplate();return this.container.innerHTML=t,this.container}},n="http://127.0.0.1:3000",a={garage:`${n}/garage`,engine:`${n}/engine`,winners:`${n}/winners`},s={},i=["Peugeot","Nissan","BMW","Audi","Toyota","Honda","Cadillac","Ford","Infiniti","Pontiac","Hummer","Subaru","Lexus","Mazda","Acura","Opel"],r=["206","Skyline","Lancer","TT","Crown","MX-5","Escalade","Mustang","IX35","GTP","H2","Impreza","LS400","Civic","Integra","Corsa"],c=async t=>(await fetch(`${a.garage}/${t}`)).json(),o=async t=>(await fetch(a.garage,{method:"POST",body:JSON.stringify(t),headers:{"Content-Type":"application/json"}})).json();function l(t){const{top:e,left:n,width:a,height:s}=t.getBoundingClientRect();return{x:n+a/2,y:e+s/2}}const d=class{constructor(t,e){this.color=t,this.id=e,this.indexSVG=this.setCarView()}setCarView(){return this.id%7==0?3:this.id%5==0?2:this.id%3==0?1:0}getElementTemplate(){return 3===this.indexSVG?`<svg version="1.2" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 324 94" width="70" height="20">\n                <path fill="${this.color}" d="m324 88.1c-0.5 3.4-4.3 5-23.9 5-3.9 0-8.3 0-13.6-0.2q1.4-1.2 2.6-2.6c0.7-0.8 1.4-1.6 2-2.6 2.6-4 4.2-8.7 4.2-13.8 0-14.1-11.5-25.6-25.6-25.6-14 0-25.5 11.5-25.5 25.6 0 4.6 1.4 8.9 3.5 12.6q0.8 1.4 1.8 2.7c0.7 0.9 1.4 1.9 2.2 2.7-56.5-1.3-139.3-1.7-168.7-1.8 1.2-0.8 2.3-1.7 3.3-2.6 0.8-0.8 1.6-1.7 2.4-2.7 3.5-4.3 5.7-9.8 5.7-15.9 0-14.1-11.4-25.5-25.5-25.5-14 0-25.5 11.4-25.5 25.5 0 2.7 0.6 5.3 1.4 7.8 0.3 0.9 0.5 1.7 0.9 2.5 0.3 0.9 0.8 1.7 1.3 2.4-6.6 1.8-16.2 4.2-20.8 4.2-1.6 0-15.3-0.2-21.3-7-1.8-2.1-2.7-4.7-2.7-7.4l-2.2-2.9v-19.1l3.8 3.1c0.5-0.8 2.8-5.1 2.8-23.4 0-2.2 0-3 13.9-4.4l-8.2-11-3.7-0.4c-2.9-0.3-6.3-2.3-7.5-4.6-1.3-2.2 0.1-3.7 3-3.4l24 2.5c2.9 0.3 6.2 2.4 7.5 4.6 1.2 2.2-0.1 3.7-3 3.4l-7.4-0.7 6.5 8.7c2.3-0.2 4.8-0.4 7.6-0.6 5.2-2.9 43.6-23.2 90.6-23.2 38.9 0 52.4 7.5 73 18.9 5.8 3.3 12.5 7 20.4 10.9 5.1 0.1 38.9 1.2 47.8 3.7l0.6 0.2 8.1 4.4c4.1 0.2 25.7 2 35.4 16.1 5.1 7.4 6 16.8 2.6 27.9 6.7 2.5 6.3 5 6.2 6z"/>\n                <path fill="${this.color}" d="m50.9 77.8q-0.6-1.2-1-2.5c-0.7-2-1.2-4.2-1.2-6.4 0-11.2 9.1-20.2 20.2-20.2 11.2 0 20.2 9 20.2 20.2 0 6.5-3.1 12.2-7.9 15.9-1.3 1-2.7 2-4.3 2.6-2.3 1-4.7 1.5-7.3 1.6-0.2 0-0.4 0.1-0.7 0.1-6.9 0-13.1-3.5-16.7-8.9-0.5-0.8-0.9-1.6-1.3-2.4z"/>\n                <path fill="${this.color}" d="m261.2 92.1c-1.5-0.7-2.9-1.6-4.2-2.7q-1.5-1.3-2.8-2.7c-2.8-3.5-4.7-8-4.7-12.8 0-11.2 9.1-20.3 20.3-20.3 11.1 0 20.2 9.1 20.2 20.3 0 5.2-2.1 10-5.5 13.6q-1.3 1.4-2.8 2.6-2.1 1.5-4.4 2.5c-2.4 0.9-4.9 1.5-7.5 1.5-3.1 0-6-0.8-8.6-2z"/>\n              </svg>\n      `:2===this.indexSVG?`<svg version="1.2" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 696 236" width="70" height="24">\n                <path fill="${this.color}"\n                  d="m683.3 193.3q-0.1 0-0.2 0h-37.1c-7.3 24.7-30.1 42.7-57.1 42.7-27.1 0-49.9-18-57.1-42.7h-349.1c-7.2 24.7-30.1 42.7-57.1 42.7-27 0-49.8-18-57.1-42.7h-39.5c-10.2 0-18.6-7.9-19.2-18l-2.5-37.2q0-0.9 0-1.8 0-1 0.1-1.9 0.2-0.9 0.4-1.8 0.2-0.9 0.5-1.8l9.6-29.2-5-27.2c-1.1-5.9 2.6-11.7 8.4-13.3l14.1-3.7-6.5-24.5-5.5-0.8c-14.8-2-25.1-15.6-23.1-30.3q0.1-0.4 0.3-0.8 0.2-0.3 0.5-0.6 0.4-0.2 0.8-0.3 0.4-0.1 0.8-0.1l36.2 5c14.7 2 25 15.6 23 30.3q-0.1 0.4-0.3 0.8-0.2 0.3-0.5 0.6-0.3 0.2-0.7 0.4-0.4 0.1-0.8 0l-14.4-2 5 18.4c28.4-7.2 57.2-13.4 86.1-18.4 29-5 58.1-8.9 87.4-11.6 29.2-2.8 58.5-4.3 87.9-4.8 29.4-0.4 58.8 0.3 88.1 2.2q2.5 0.1 5 0.4 2.4 0.3 4.9 0.7 2.5 0.4 4.9 1 2.4 0.5 4.8 1.1 2.4 0.7 4.8 1.5 2.4 0.7 4.7 1.6 2.3 0.9 4.6 1.9 2.3 1 4.5 2.1l90.2 45.4q3 1.5 6.2 2.8 3.1 1.4 6.3 2.5 3.2 1 6.5 1.9 3.2 0.9 6.6 1.6l83.1 16.1q4.9 1 9.5 2.9 4.6 1.8 8.8 4.5 4.2 2.7 7.9 6.1 3.6 3.4 6.5 7.4l13.7 18.9c1.9 0.8 3.6 1.8 5.2 3 1.6 1.2 2.9 2.7 4 4.4 1.2 1.6 2 3.4 2.6 5.3 0.6 1.9 0.9 3.9 0.9 5.9v14.5c0 2-0.3 4-0.9 5.9-0.5 1.9-1.4 3.8-2.5 5.4-1.1 1.7-2.5 3.2-4 4.5-1.6 1.2-3.3 2.3-5.2 3.1zm-624.5-72.5l-3.8-9.9q-0.2-0.4-0.4-0.8-0.3-0.4-0.6-0.7-0.4-0.4-0.8-0.6-0.4-0.2-0.8-0.4l-16.8-5.8q-0.9-0.3-1.8-0.2-0.9 0.1-1.7 0.5-0.8 0.5-1.4 1.2-0.5 0.7-0.7 1.6l-3.9 15c-0.6 2.7 1.4 5.3 4.1 5.4l24.5 0.7c3.1 0 5.3-3.1 4.1-6zm32.1 55.7q0 2.2 0.3 4.4 0.3 2.2 0.9 4.3 0.5 2.1 1.3 4.2 0.8 2 1.9 3.9c5.9 10.7 17.3 17.9 30.3 17.9 13 0 24.4-7.2 30.3-17.9q1.1-1.9 1.9-3.9 0.8-2.1 1.4-4.2 0.5-2.1 0.8-4.3 0.3-2.2 0.3-4.4c0-19.1-15.6-34.7-34.7-34.7-19.1 0-34.7 15.6-34.7 34.7zm112.9-132.8l-37.4 5.4q-3.4 0.5-6.7 1.6-3.3 1.1-6.3 2.8-3 1.8-5.6 4-2.7 2.3-4.8 5c-1.7 2.1-0.1 5.2 2.6 5l32.6-2.1q4-0.2 7.9-1.4 3.8-1.1 7.3-3 3.5-1.9 6.5-4.6 3.1-2.6 5.4-5.8l1.5-2c1.6-2.2-0.3-5.2-3-4.9zm17.7 73.7l11.5 30.6q1.4 3.7 3.6 7.1 2.2 3.3 5 6.1 2.9 2.8 6.3 4.9 3.4 2.2 7.2 3.5l2.3 0.8c2.6 0.9 4.9-1.8 3.8-4.3l-16.1-34.2q-1.4-3.1-3.5-6-2-2.8-4.5-5.1-2.6-2.4-5.5-4.2-2.9-1.9-6.1-3.2c-2.5-1-5 1.5-4 4zm295.6-18.6h-0.1l-90.2-45.4q-3.4-1.7-6.9-3-3.5-1.3-7.1-2.3-3.6-1-7.3-1.6-3.7-0.6-7.4-0.8-8.7-0.6-17.4-1-8.8-0.4-17.5-0.7-8.7-0.3-17.5-0.4-8.7-0.2-17.5-0.2-28 0-56.1 1.5-2.7 0.1-5.3 0.7-2.7 0.6-5.2 1.6-2.5 1-4.9 2.4-2.3 1.4-4.3 3.2c-15.6 13.5-31.3 29.6-29.8 38.9 2.9 17.2 266.6 19.7 285 19.8q0.2 0 0.5 0 0.2 0 0.5-0.1 0.2 0 0.5-0.1 0.2 0 0.4-0.1l7.2-2.9c4.1-1.6 4.4-7.4 0.4-9.5zm71.8 43c-19.1 0-34.7 15.6-34.7 34.7q0 2.2 0.3 4.4 0.3 2.2 0.8 4.3 0.6 2.1 1.4 4.2 0.8 2 1.9 3.9c5.9 10.7 17.2 17.9 30.3 17.9 13 0 24.4-7.2 30.3-17.9q1.1-1.9 1.9-3.9 0.8-2.1 1.3-4.2 0.6-2.1 0.9-4.3 0.2-2.2 0.2-4.4c0-19.1-15.5-34.7-34.6-34.7zm74.1-2.4l-14.2-17.8q-0.1-0.1-0.2-0.2-0.2-0.1-0.3-0.2-0.1 0-0.3-0.1-0.1 0-0.3-0.1l-31.5-5.3c-1.7-0.3-2.6 1.9-1.2 2.9l22.6 17.2q0.1 0.1 0.1 0.1 0.1 0.1 0.2 0.1 0 0 0.1 0.1 0.1 0 0.2 0l23.1 6c1.6 0.4 2.7-1.4 1.7-2.7z" />\n                  <path fill="${this.color}" d="m588.9 163.4c7.2 0 13 5.9 13 13.1 0 7.2-5.8 13.1-13 13.1-7.3 0-13.1-5.9-13.1-13.1 0-7.2 5.8-13.1 13.1-13.1zm-463.3 0c7.3 0 13.1 5.9 13.1 13.1 0 7.2-5.8 13.1-13.1 13.1-7.2 0-13.1-5.9-13.1-13.1 0-7.2 5.9-13.1 13.1-13.1z" />\n              </svg>`:1===this.indexSVG?`<svg version="1.2" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 492 133" width="70" height="19">\n                <path fill="${this.color}" d="m0.6 58.9c0.3-8.5 7.9-20.5 10.4-24.2-1.7-2.7-2.6-4.8-1.7-6.5 1-1.8 3.1-1.8 3.9-1.8 1.3 0 2.9 0.3 4.9 0.5 4.5 0.7 11.1 1.4 16.5 0.3 11.1-2 26.3-3.2 41.7-3.2 4 0 7.7 0.1 11.1 0.3 12.6 0.5 35.1-5.6 64.1-13.4l10.8-2.9c14.5-3.9 25.6-5.9 33.1-5.9 4 0 6.2 0.6 7.4 1.2q1.3-0.4 2.5-0.4c4 0 5.9 3.4 6.6 6.3 2.2-0.1 3.7 1.1 4.6 2.3 3.4-0.3 5 2 5.1 2.3l0.3 0.4v19.8c7 1.8 44.8 4 73.5 5.4q-1.3-1.3-2.1-2.8c-1.6-3.2-1.2-6.5-0.7-8.5l-31.7-13.9-0.2-0.9c-0.1-0.2-1.2-5.1 1.7-8.8 2-2.5 5.3-3.8 9.9-3.8q1.9 0 4.3 0.3c16.4 2.4 81.9 33 88 35.9 77.6 3 126 43.2 126.4 43.6l0.7 0.6v22.2l-0.4 0.5c-9.5 12.3-45.1 17.8-77.9 19.1 0.5-0.7 1-1.4 1.5-2.1 0.5-0.6 0.8-1.3 1.2-2 4.1-6.7 6.4-14.5 6.4-22.8 0-24.5-19.9-44.4-44.4-44.4-24.4 0-44.4 19.9-44.4 44.4 0 6.6 1.5 12.9 4.2 18.6q0.4 1 0.9 2 0.6 1 1.2 2c-33.5-1.6-100-1.9-160.4-2.1-21.6-0.1-42.9-0.2-62-0.3 0.3-0.6 0.6-1.3 0.9-2 0.3-0.6 0.7-1.2 0.9-1.9 2.5-5.7 3.9-12 3.9-18.5 0-26-21.2-47.1-47.1-47.1-26 0-47.2 21.1-47.2 47.1 0 5 0.9 9.8 2.3 14.4q0.4 1.2 0.9 2.4 0.4 1.1 0.9 2.3c-10.1-2.4-18-6.7-23.5-13-11.2-12.8-9.8-30-9.2-38.3 0.1-1 0.2-2 0.2-2.7z"/>\n                <path fill="${this.color}" d="m378.2 132.5c-11.4 0-21.4-5.2-28.1-13.3-0.5-0.7-1.2-1.4-1.7-2.1-0.5-0.7-0.9-1.3-1.3-2-3.4-5.6-5.5-12.1-5.5-19.1 0-20.2 16.4-36.6 36.6-36.6 20.2 0 36.5 16.4 36.5 36.6 0 8.9-3.3 16.9-8.5 23.2-0.6 0.6-1 1.4-1.6 2-0.7 0.7-1.5 1.3-2.2 2-6.5 5.7-14.9 9.3-24.2 9.3z"/>\n                <path fill="${this.color}" d="m109.5 114.2c-0.4 0.7-0.7 1.3-1.1 2-7.1 10.1-18.9 16.8-32.2 16.8-14.1 0-26.3-7.4-33.3-18.5-0.4-0.7-0.7-1.5-1.1-2.2-0.4-0.7-0.9-1.4-1.2-2.2-2.3-5-3.7-10.5-3.7-16.3 0-21.7 17.6-39.3 39.3-39.3 21.6 0 39.2 17.6 39.2 39.3 0 6.7-1.8 12.9-4.8 18.4-0.3 0.7-0.7 1.4-1.1 2z"/>\n              </svg>\n      `:0===this.indexSVG?`<svg version="1.2" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 331 105" width="70" height="22">\n                <path fill="${this.color}" d="m324.3 91.9c-6.6 1.8-15.2 2.2-15.2 2.2h-2.3c2-3.9 3.1-8.3 3.1-13.1 0-15.9-13-28.9-29-28.9-16 0-29 13-29 28.9 0 4.7 1.2 9.2 3.2 13.1l-156-1.2c1.6-3.6 2.5-7.6 2.5-11.9 0-15.9-13-28.9-29-28.9-15.9 0-29 13-29 28.9 0 3.4 0.6 6.5 1.7 9.5-14.5-2.1-34.7-5.3-39.4-7.1-7.7-3-5.7-27.2-5.7-27.2 0 0 6.3-1.5 6.3-7.6 0-6.2 0-16.6 0-16.6 0 0 5.7 0 2.5-3.1-3.1-3.2 5.2-2.9 5.2-2.9 0 0 17.4 5.2 27.8-1.8 10.4-6.9 49.5-19.5 49.5-19.5v-4.1c6.8-1.4 13.3 1.1 13.3 1.1 27-2.5 52.5 0 67.6 1.1 15.1 1.2 51.2 23.1 56.3 26.2 5.2 3.2 14.5 4.2 34 4.2 19.4 0 26.7 5.9 26.7 5.9 39.8 9.1 35.3 18.8 38.2 23.2 2.9 4.4 3.3 25.7 3.3 25.7-8.1 0.6-6.6 3.9-6.6 3.9z"/>\n                <path fill="${this.color}" d="m280.9 57.4c13.1 0 23.7 10.6 23.7 23.6 0 4.9-1.4 9.4-3.9 13.1-4.3 6.4-11.5 10.6-19.8 10.6-8.2 0-15.5-4.2-19.7-10.6-2.5-3.7-4-8.2-4-13 0-13.1 10.7-23.7 23.7-23.7z"/>\n                <path fill="${this.color}" d="m72.7 57.4c13 0 23.7 10.6 23.7 23.6 0 4.4-1.3 8.4-3.3 11.9-4.1 7-11.7 11.8-20.4 11.8-9.4 0-17.4-5.5-21.3-13.3-1.5-3.2-2.4-6.6-2.4-10.4 0-13 10.6-23.6 23.7-23.6z"/>\n              </svg>\n      `:void 0}},h=class extends t{constructor(t,e,n){super(t,e),this.container.id=n,this.cars=[],this.carsCount="0",this.curentPage=1,this.randomCarsCount=100}async getGarageData(){const t=await(async(t=1,e=7)=>{const n=await fetch(`${a.garage}?_page=${t}&_limit=${e}`);return{cars:await n.json(),carsCount:n.headers.get("X-Total-Count")??"0"}})(this.curentPage);this.cars=t.cars,this.carsCount=t.carsCount}async addListeners(){const t=this.container.querySelector("#create"),e=this.container.querySelector("#update"),n=this.container.querySelector(".garage__icon-race"),s=this.container.querySelector(".garage__icon-reset"),i=this.container.querySelector(".garage__icon-random"),r=this.container.querySelector(".garage__page_prev"),c=this.container.querySelector(".garage__page_next"),l=this.container.querySelectorAll(".car__btn_delete"),d=this.container.querySelectorAll(".car__btn_custom"),h=this.container.querySelectorAll(".car__btn_start"),u=this.container.querySelectorAll(".car__btn_stop"),g=this.container.querySelector(".garage__result");t?.addEventListener("submit",(async e=>{e.preventDefault();const n=t.input.value,a=t.color.value;if(n&&a){const t={name:n,color:a};await o(t),this.reRender()}})),e?.addEventListener("submit",(async t=>{t.preventDefault();const n=e.dataset.id,s=e.input.value,i=e.color.value;if(s&&i&&n){const t={name:s,color:i};await(async(t,e)=>(await fetch(`${a.garage}/${t}`,{method:"PUT",body:JSON.stringify(e),headers:{"Content-Type":"application/json"}})).json())(+n,t),this.reRender()}})),l.forEach((t=>{t.addEventListener("click",(async t=>{t.preventDefault();const e=t.target.dataset.id;if(e){await(async t=>(await fetch(`${a.garage}/${t}`,{method:"DELETE"})).json())(+e),await(async t=>(await fetch(`${a.winners}/${t}`,{method:"DELETE"})).json())(+e);const t=document.querySelector(".winners__update"),n=new Event("click");t.dispatchEvent(n),this.reRender()}}))})),d.forEach((n=>{n.addEventListener("click",(async n=>{n.preventDefault();const a=n.target;a.style.color="#7afeff";const s=a.dataset.id;t.input.disabled=!0,t.color.disabled=!0,t.btn.disabled=!0,e.dataset.id=s,e.input.disabled=!1,e.input.value="nissan",e.color.disabled=!1,e.btn.disabled=!1}))})),h.forEach((t=>{t.addEventListener("click",(async t=>{t.preventDefault();const e=t.target.dataset.id;e&&this.startMoving(+e)}))})),u.forEach((t=>{t.addEventListener("click",(async t=>{t.preventDefault();const e=t.target.dataset.id;e&&this.stopMoving(+e)}))})),n.addEventListener("click",(async t=>{t.preventDefault(),n.disabled=!0,i.disabled=!0;let e=[];e=this.cars.map((t=>this.startMoving(t.id)));const r=this.cars.map((t=>t.id));try{const t=await this.raceAll(e,r);t.id&&t.time&&(g.textContent=`Best Result: ${t.name} - ${t.time}s`,await(async(t,e)=>{if(404===await(async t=>(await fetch(`${a.winners}/${t}`)).status)(t))await(async t=>(await fetch(a.winners,{method:"POST",body:JSON.stringify(t),headers:{"Content-Type":"application/json"}})).json())({id:t,wins:1,time:e});else{const n=await(async t=>{try{const e=await fetch(`${a.winners}/${t}`);return await e.json()}catch{throw new Error("Ошибка")}})(t);await(async(t,e)=>(await fetch(`${a.winners}/${t}`,{method:"PUT",body:JSON.stringify(e),headers:{"Content-Type":"application/json"}})).json())(t,{id:t,wins:+n.wins+1,time:e<+n.time?e:n.time})}})(t.id,+t.time));const n=document.querySelector(".winners__update"),c=new Event("click");n.dispatchEvent(c),s.disabled=!1,i.disabled=!1}catch(t){alert("All engines were broken."),s.disabled=!1,i.disabled=!1}})),s.addEventListener("click",(async t=>{t.preventDefault(),this.cars.map((t=>this.stopMoving(t.id))),s.disabled=!0,setTimeout((()=>{g.textContent="",n.disabled=!1}),1200)})),i.addEventListener("click",(async t=>{t.preventDefault(),i.disabled=!0;const e=await this.getRandomCars();for(const t of e)await o(t);this.reRender()})),r.addEventListener("click",(t=>{t.preventDefault(),this.curentPage--,this.reRender()})),c.addEventListener("click",(t=>{t.preventDefault(),this.curentPage++,this.reRender()}))}async getRandomCars(){return new Array(this.randomCarsCount).fill("_").map((()=>({name:`${i[Math.floor(Math.random()*i.length)]} ${r[Math.floor(Math.random()*r.length)]}`,color:"#"+Math.floor(16777215*Math.random()).toString(16).padStart(6,"0")})))}async raceAll(t,e){const{success:n,carId:a,time:s}=await Promise.any(t);if(!n){const n=e.findIndex((t=>t===a)),s=[...t.slice(0,n),...t.slice(n+1,t.length)],i=[...e.slice(0,n),...e.slice(n+1,e.length)];return this.raceAll(s,i)}return{...this.cars.find((t=>t.id===a)),time:(+s/1e3).toFixed(3)}}async startMoving(t){const e=document.getElementById(`btn-start-${t}`),n=document.getElementById(`btn-stop-${t}`);e.disabled=!0;const{velocity:i,distance:r}=await(async t=>(await fetch(`${a.engine}?id=${t}&status=started`,{method:"PATCH"})).json())(t);n.disabled=!1;const c=Math.round(r/i),o=document.getElementById(`car-${t}`),d=document.getElementById(`finish-${t}`),h=Math.floor(function(t,e){const n=l(t),a=l(e);return Math.hypot(n.x-a.x,n.y-a.y)}(o,d))-38;s[t]=function(t,e,n){let a=null;const s={};return s.id=window.requestAnimationFrame((function i(r){a||(a=r);const c=r-a,o=Math.round(c*(e/n));t.style.transform=`translateX(${Math.min(o,e)}px)`,o<e&&(s.id=window.requestAnimationFrame(i))})),s}(o,h,c);const{success:u}=await(async t=>{const e=await fetch(`${a.engine}?id=${t}&status=drive`,{method:"PATCH"}).catch();return 200!==e.status?{success:!1}:{...await e.json()}})(t);return u||window.cancelAnimationFrame(s[t].id),{success:u,carId:t,time:c}}async stopMoving(t){document.getElementById(`btn-stop-${t}`).disabled=!0,await(async t=>(await fetch(`${a.engine}?id=${t}&status=stopped`,{method:"PATCH"})).json())(t),document.getElementById(`btn-start-${t}`).disabled=!1,document.getElementById(`car-${t}`).style.transform="translateX(0)",s[t]&&window.cancelAnimationFrame(s[t].id)}getCarItems(){return this.cars.map((t=>new class{constructor(t,e,n){this.name=t,this.color=e,this.id=n,this.icon=new d(this.color,this.id)}getElementTemplate(){return`\n    <li class="garage__item">\n      <div class="car" id="${this.id}">\n        <div class="car__controls">\n          <button class="car__btn car__btn_start btn" type="button" id="btn-start-${this.id}" \n          data-id=${this.id}>\n          </button>\n          <button class="car__btn car__btn_stop btn" type="button" id="btn-stop-${this.id}" \n          data-id=${this.id} disabled>\n          </button>\n          <span class="car__name">${this.name}</span>\n          <button class="car__btn car__btn_custom btn" type="button" data-id="${this.id}">Customize</button>\n          <button class="car__btn car__btn_delete btn" type="button" data-id="${this.id}">Delete</button>\n        </div>\n        <div class="car__race">\n          <div class="car__ride" id="car-${this.id}">\n            ${this.icon.getElementTemplate()}\n          </div>\n          <div class="car__track"></div>\n          <span class="car__finish" id="finish-${this.id}"></span>\n        </div>\n      </div>\n    </li>\n    `}render(){return this.getElementTemplate()}}(t.name,t.color,t.id).render())).join("")}isPrevPageBtnDisable(){return this.curentPage<=1?"disabled":""}isNextPageBtnDisable(){return 7*this.curentPage>=+this.carsCount?"disabled":""}getElementTemplate(){return`\n      <div class="garage__manipulation">\n        <div class="garage__manipulation-controls">\n          <form class="garage__control" id="create">\n            <input class="garage__input" type="text" name="input">\n            <input class="garage__input" type="color" name="color" value="#2962e3">\n            <button class=" garage__btn btn" name="btn" type="submit">Create</button>\n          </form>\n          <form class="garage__control" id="update">\n            <input class="garage__input" type="text" name="input" disabled>\n            <input class="garage__input" type="color" name="color" disabled>\n            <button class="garage__btn btn" type="submit" name="btn" disabled>Customize</button>\n          </form>\n        </div>\n        <button class="garage__icon garage__icon-random btn"></button>\n        <button class="garage__icon garage__icon-race btn"></button>\n        <button class="garage__icon garage__icon-reset btn" disabled></button>\n      </div>\n      <h1 class="garage__title">Cars in garage (${this.carsCount}) <span class="garage__result"></span></h1>\n      <ul class="garage__list">\n         ${this.getCarItems()}\n      </ul>\n      <div class="garage__pages">\n        <button class="garage__page garage__page_prev" type="button" ${this.isPrevPageBtnDisable()}></button>\n        <span class="garage__current-page">Page #${this.curentPage}</span>\n        <button class="garage__page garage__page_next" type="button" ${this.isNextPageBtnDisable()}></button>\n      </div>\n    `}async render(){await this.getGarageData();const t=this.getElementTemplate();return this.container.innerHTML=t,this.container}async reRender(){await this.getGarageData();const t=this.getElementTemplate();this.container.innerHTML=t,this.addListeners()}},u=class extends t{constructor(t,e,n){super(t,e),this.container.id=n,this.winners=[],this.winnersCount="0",this.curentPage=1}async getGarageData(){const t=await(async(t=1,e=10,n="wins",s="DESC")=>{const i=await fetch(`${a.winners}?_page=${t}&_limit=${e}&_sort=${n}&_order=${s}`),r=await i.json(),o=i.headers.get("X-Total-Count")??"0";return{items:await Promise.all(r.map((async t=>({...t,car:await c(t.id)})))),count:o}})(this.curentPage);this.winners=t.items,this.winnersCount=t.count}getWinnerRow(){return this.winners.map(((t,e)=>new class{constructor(t,e,n,a,s,i){this.id=t+1,this.carId=i??1,this.wins=e,this.time=n,this.color=a??"#000",this.name=s??"Car",this.icon=new d(this.color,this.carId)}getElementTemplate(){return`\n      <tr class="winners__table-row">\n        <td>${this.id}</td>\n        <td>${this.icon.getElementTemplate()}</td>\n        <td>${this.name}</td>\n        <td>${this.wins}</td>\n        <td>${this.time}</td>\n      </tr>\n    `}render(){return this.getElementTemplate()}}(e,t.wins,t.time,t.car?.color,t.car?.name,t.car?.id).render())).join("")}isPrevPageBtnDisable(){return this.curentPage<=1?"disabled":""}isNextPageBtnDisable(){return 10*this.curentPage>=+this.winnersCount?"disabled":""}getElementTemplate(){return`\n      <h1 class="winners__title">Winners (${this.winnersCount})</h1>\n      <div class="winners__content"">\n        <table class="winners__table">\n          <tr class="winners__table-header">\n            <th>#</th>\n            <th>Car</th>\n            <th>Name</th>\n            <th>Wins</th>\n            <th>Best time</th>\n          </tr>\n          ${this.getWinnerRow()}\n        </table>\n      </div>\n      <button class="winners__update btn"></button>\n      <div class="winners__pages">\n        <button class="winners__page winners__page_prev" type="button" ${this.isPrevPageBtnDisable()}></button>\n        <span class="winners__current-page">Page #${this.curentPage}</span>\n        <button class="winners__page winners__page_next" type="button" ${this.isNextPageBtnDisable()}></button>\n      </div>\n    `}async addListeners(){const t=this.container.querySelector(".winners__update"),e=this.container.querySelector(".winners__page_prev"),n=this.container.querySelector(".winners__page_next");t.addEventListener("click",(t=>{t.preventDefault(),this.reRender()})),e.addEventListener("click",(t=>{t.preventDefault(),this.curentPage--,this.reRender()})),n.addEventListener("click",(t=>{t.preventDefault(),this.curentPage++,this.reRender()}))}async render(){await this.getGarageData();const t=this.getElementTemplate();return this.container.innerHTML=t,this.container}async reRender(){await this.getGarageData();const t=this.getElementTemplate();this.container.innerHTML=t,this.addListeners()}},g=class extends t{constructor(t,e){super(t,e),this.garage=new h("section","garage active","garage"),this.winners=new u("section","winners","winners")}async getContentNode(){const t=document.createElement("div");return t.className="content__container container",t.append(await this.garage.render()),t.append(await this.winners.render()),t}async addListeners(){await this.garage.addListeners(),await this.winners.addListeners()}async render(){return this.container.append(await this.getContentNode()),this.container}},m=class extends t{getElementTemplate(){return'\n      <div class="footer__container container">\n        <span class="footer__info">© 2023</span>\n        <a class="footer__link" href="https://github.com/vadim-m" target="_blank">@vadim-m</a>\n        <a class="footer__link" href="https://rs.school/js/" target="_blank">RS School</a>\n      </div>\n    '}async render(){const t=this.getElementTemplate();return this.container.innerHTML=t,this.container}};(new class{constructor(){this.page=new class{constructor(){this.header=new e("header","header"),this.main=new g("main","content"),this.footer=new m("footer","footer")}async listen(){await this.header.addListeners(),await this.main.addListeners()}async render(){document.body.append(await this.header.render()),document.body.append(await this.main.render()),document.body.append(await this.footer.render())}}}async run(){await this.page.render(),await this.page.listen()}}).run()})();